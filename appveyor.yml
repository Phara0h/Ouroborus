version: 1.0.{build}
branches:
  only:
  - master
image:
- macOS
- Ubuntu
- Visual Studio 2017
platform: Any CPU
environment:
  REPO:
    secure: RuxL+CFg1/bpi2CaOTBKt/4sCItaGoVeAzjtq246h9n5Z/vv+gT6Erm92A+/RWKdEK12UZAIuitS8tNlTVlbj7UfNIupGxt5n6po/VKiMlOD9tpyrhvymNQhDDBcfW6p

matrix:
  - fast_finish: true
for:
  -
    matrix:
      only:
        - image: Visual Studio 2017
    build_script:
    - PS: >-
        cd http

        git clone https://github.com/uNetworking/uSockets

        cd ..

        call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat

        nmake

        git checkout binaries

        xcopy /Y dist\*.node .

        git add Ouroborus*

        git status

        git pull origin binaries

        git config --global user.email "jtwhissel@gmail.com"

        git config --global user.name "Phara0h"

        git commit -a -m "Updated binaries" --allow-empty

        git push "https://phara0h:%SECRET%@github.com/Phara0h/Ouroborus" binaries

  -
    matrix:
      only:
        - image: Ubuntu
        - image: macOS
    build_script:
    - sh: >-
        cd http

        git clone https://github.com/uNetworking/uSockets

        cd ..

        make

        git checkout binaries

        cp dist/*.node .

        git add Ouroborus*

        git status

        git pull origin binaries

        git config --global user.email "jtwhissel@gmail.com"

        git config --global user.name "Phara0h"

        git commit -a -m "Updated binaries" --allow-empty

        git push "https://phara0h:${SECRET}@github.com/Phara0h/Ouroborus"binaries
